let restaurant;var map;window.initMap=(()=>{registerServiceWorker(),fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),google.maps.event.addListenerOnce(map,"idle",()=>{document.getElementsByTagName("iframe")[0].title="Google Maps"}))})}),registerServiceWorker=(()=>{navigator.serviceWorker?(DBHelper.openIDB(),navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker Registerd Successfully!"),navigator.serviceWorker.addEventListener("message",e=>{"submitReviews"===e.data.action&&DBHelper.sendSavedReviews()})}).catch(e=>{console.log("Error Registering Service Worker. Please look into it")})):console.log("Service Worker not supported")}),requestBackgroundSync=(e=>{navigator.serviceWorker&&(console.log("Requesting Sync",e),navigator.serviceWorker.ready.then(function(e){return e.sync.register("submitReviewSync")}))}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(r,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),DBHelper.fetchRestaurantReviews(t,(e,t)=>{t?(self.restaurant.reviews?updateReviewsHTML(t):fillReviewsHTML(t),self.restaurant.reviews=t):console.error(e)}),e(null,n)):console.log(r)}):(error="No restaurant id in URL",e(error,null))}),toggleFavorite=(e=>{const t="favorite"==document.getElementById("favoriteIcon").innerHTML,r=document.getElementById("favoriteIcon");t?(e.is_favorite=!1,r.innerHTML="favorite_border"):(e.is_favorite=!0,r.innerHTML="favorite"),DBHelper.updateRestaurantFavorite(e,(e,t)=>{self.restaurant=t,t||console.error(e)})}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name;const t=!!e.is_favorite&&JSON.parse(e.is_favorite);document.getElementById("favoriteIcon").innerHTML=t?"favorite":"favorite_border",document.getElementById("favorite").addEventListener("click",()=>toggleFavorite(e)),document.getElementById("restaurant-address").innerHTML=e.address,e.photograph||(e.photograph="not-available");const r=e.photograph.concat("-320_small.jpg"),n=document.getElementById("restaurant-picture"),a=document.createElement("source");a.media="(min-width: 651px) and (max-width: 800px), (max-width: 350px)",a.srcset="/images/"+r,n.prepend(a);const o=document.createElement("source");o.media="(min-width: 801px), (max-width: 650px) and (min-width: 550px)",o.srcset="/img/"+e.photograph+".jpg",n.prepend(o);const i=document.getElementById("restaurant-img");i.className="restaurant-img",i.src=DBHelper.imageUrlForRestaurant(e),i.alt=`${e.name} restaurant picture`,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let r in e){const n=document.createElement("tr");n.setAttribute("tabindex",0);const a=document.createElement("td");a.innerHTML=r,n.appendChild(a);const o=document.createElement("td");o.innerHTML=e[r],n.appendChild(o),t.appendChild(n)}}),updateReviewsHTML=(e=>{e=e.filter(e=>{self.restaurant.reviews.forEach(t=>{if(e.id==t.id)return!1})});const t=document.getElementById("reviews-list");e.forEach(e=>{t.prepend(createReviewHTML(e))})}),fillReviewsHTML=(e=>{console.log("filling review",e);const t=document.getElementById("reviews-container"),r=document.createElement("h3");if(r.innerHTML="Reviews",t.appendChild(r),!e||!e.length){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const n=document.getElementById("reviews-list");e.forEach(e=>{n.prepend(createReviewHTML(e))}),t.appendChild(n)}),onSubmitReview=(e=>{e.preventDefault();const t=document.getElementById("reviewForm");var r={restaurant_id:self.restaurant.id,createdAt:Date.now(),updatedAt:Date.now()};for(let e=0;e<t.length-1;e++)r[t[e].name]=t[e].value;DBHelper.postRestaurantReview(r,(e,t)=>{self.restaurant.reviews.push(r),document.getElementById("reviews-list").prepend(createReviewHTML(r)),t||(console.error(e),requestBackgroundSync("submitReviewSync"),DBHelper.saveReviews(r))})}),createReviewHTML=(e=>{const t=document.createElement("li");t.setAttribute("tabindex",0);const r=document.createElement("p");r.innerHTML=e.name,t.appendChild(r);const n=document.createElement("p");n.innerHTML=new Date(e.createdAt).toUTCString(),t.appendChild(n);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),r=document.createElement("li");r.innerHTML=e.name,t.appendChild(r)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null});